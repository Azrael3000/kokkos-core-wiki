## Scope of Kokkos Testing

Software testing accompanies all development activities and is performed by each Kokkos developer in their work flow. Daily tasks include implementation of new features, debugging, development of test problems, user support and documentation. A critical consideration for Kokkos integration into a host code is performance improvement; this necessitates identification of and improvement of Kokkos algorithms performance characteristics through testing.  An algorithm is presumed to have “failed” if it leads to a slow-down in performance. An additional consideration in the daily Kokkos workflow is maintenance of the quality/integrity of Kokkos software. This is addressed by creating levels of approval that govern when and how algorithms may be modified and created. An important requirement for committing to the development branch of Kokkos (develop) is code review and algorithm testing; all tests must pass at a designated level. (own hardware? a few platforms? all platforms?) The most rigorous testing is conducted for promotion of a fully-tested and clean develop branch into the Kokkos host software project, i.e, Trilinos. The **Kokkos Promotion Testing** section (to follow) is devoted to this most important exercise in the Kokkos workflow.

This section of the Testing description develops the primary focus of the document, the Kokkos Testing Workflow. It includes the multiple testing tasks the Kokkos team performs as outlined above. Two important aspects of the workflow are described first as these are the foundational elements of a developer’s daily tasks; these are the **Git Terminology and Kokkos Branches** and the **Kokkos Test Scripts**. Following these sections, Developer Daily Tasks can be described more easily. Finally, the all-important **Promotion Testing** is presented in detail as this task must be performed exactly as described for a successful promotion of bug fixes and new features into the hands of host code developers.

## Git Repository Terminology and Kokkos Branches

In Git, a branch is a divergence from the main (or master) line of a software repository; it is where most of the development takes place. The Kokkos team uses two main Git branches in its software development process: Kokkos *Master* and *develop*. Other branches will exist during a development cycle, e.g. *issue-865* or *array-bounds*, but the above are the branches of interest when merging changes into the master repository. The other development branches (e.g., *issue-865*) are committed to the develop branch with a pull request to become integrated into the *develop* branch set of working changes for the development cycle.

## Kokkos Routine/Daily/Nightly Testing

Testing is a through-going aspect of software development, touching all phases of a software project. Bringing together the test scripts, the test problems and repository management methodology identified in the previous section, a team methodology has evolved that will evaluate the correctness and speed of the development product prior to commit. Each developer will use a combination of existing unit and performance tests or newly written tests in combination with existing or standalone test scripts to evaluate bugfixes, new features and evaluate one approach versus another for improving performance. Submission of a commit with a pull request will initiate a software review followed by suggestions for improvement or approval of the pull request.

Another aspect of routine testing are the nightly tests on multiple platforms initiated using the _jenkins_test_driver script_. Most/All of the test platforms identified in Table 2.1 are sent multiple jobs for a range of compilers, Kokkos backends and combinations of test problems. These are run for the develop branch (and master branch) of Kokkos. Results from these tests become the standard for evaluating the state of the Kokkos branches. These tests are design to cover the full range of architectures and compilers that Kokkos supports.

## Other Testing

A set of tutorial problems have been developed for use in hands-on training exercises. These are not part of a scheduled test regimen; however, they are run and performance data updated periodically when Kokkos capabilities have changed significantly or new compilers and architectures are added to our repertoire.


## Kokkos Promotion Testing and Promotion Processes

Special focus is given to the components of promotion testing, describing the stages of the test process by which the develop branch of Kokkos (containing the latest set of software improvements and bug fixes) are pushed into a tagged Kokkos Master and then into the Trilinos Master repository. Note, Kokkos is a Trilinos package. This process is woven into and dependent on our chosen repository management software Git [e.g., Pro Git, Chacon & Straub, 2014]. The description of the promotion workflow includes details of the many-step process, including the git commands that are integral to the promotion process.

Promotion testing refers to the process established that leads to integration of the stand-alone version of the Kokkos software back into the parent Trilinos software as a package (the basic unit of identity in Trilinos). The promotion testing process was developed to satisfy the requirements for pushing Kokkos software updates into Trilinos with the confidence that these updates will not adversely affect the integrity of other packages that depend on Kokkos, nor will it adversely affect the Trilinos software repository itself.

Promotion testing is conducted at four to eight week intervals (depending on Kokkos team commits and commitments). In Git parlance, the two important branches are develop and master. The develop branch is the remote repository to which accepted upgrades/improvements and bug-fixes are committed; origin/master is the primary remote branch of Kokkos, the pristine version of the software, that serves as the source for cloning of the repository. It is the branch from which all forks and clones take place. It is also the version of Kokkos that will be integrated back into Trilinos during the promotion process. For this promotion to take place, the develop branch of Kokkos must first pass all Kokkos tests.  Satisfactorily completed, Kokkos develop branch will be snapshotted (re-integrated) into a develop branch of Trilinos and then ran through the appropriate set of Trilinos tests. When completed satisfactorily (i.e., it has been determined that Kokkos does not produce any additional failures or differences in Trilinos test results), this testing will lead to a (git) push of the Kokkos develop branch into Trilinos and then into Kokkos master.

Promotion testing extends the baseline testing accomplished by developers, which may be limited in platform and compiler scope, to include the full set of develop branch changes, all supported compilers, and all platform architectures and execution spaces. This is the essence of the promotion testing, extending the coverage to heterogeneous combinations of CPUs, GPUs and accelerators. For this effort, a set of test scripts are utilized, described next.

Testing protocols are built into a series of scripted processes written in shell-script or python. First are the scripts generate_makefile.bash and test_all_sandia. The bulk of the Kokkos testing is conducted using the latter script, test_all_sandia. This script tests multiple compilers on a given platform. During promotion testing, generate_makefile.bash is frequently used for re-testing, a vehicle for checking results on a specific platform that have failed and require closer examination. Upon successful (all PASS) completion of the Kokkos testing, integration testing can commence. Integration testing commences using the Kokkos repository scripts located in kokkos/config/trilinos-integration. These scripts run tests on a develop branch of Trilinos that has a develop branch of Kokkos inserted as the Kokkos package software. This process of inserting Kokkos into the Trilinos repository is called snapshotting since it takes the Kokkos develop snapshot and places it into the Trilinos develop repository snapshot; this uses the Python script ( kokkos/config ) snapshot.py. A textual description of the snapshot process itself is contained in file ( kokkos/ ) HOW_TO_SNAPSHOT; the details are left to the reader.

The (work) process of testing, snapshotting, testing and committing to Trilinos and pushing to (Kokkos) Master is best described in the (outline) document kokkos-promotion.txt 
